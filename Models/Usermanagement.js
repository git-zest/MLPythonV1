var mongoose=require('mongoose');
var Schema=mongoose.Schema;
mongoose.Promise = require('bluebird');
var db=mongoose.connection;

var usermgt=new Schema({
		Username:String,
		Password: String,
		Channel: String,
		Environment:String,
		Indicator:String,
		Comments:String,
});

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////d///////////////////////////////////////////////////////////////////////////////////////////////////////////////
var usermgtObj=mongoose.model('usermgt',usermgt);
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
module.exports.createusermgt=function(username,password,channel,environment,indicator,callback){
	mongoose.connect("mongodb://userHKT:lrADL3lNvj2ug0gT@172.31.55.187:27017/transaction", function(err) {
	if(err){
		////console.log('DB error occured');
		doc1='DB Fail';
		db.close();
		mongoose.connection.close();
		//callback(doc1);
	}
	var updatedvalue=new usermgtObj({'username':username,'Password':password,'channel':channel,'environment':environment,'indicator':indicator})
		updatedvalue.save(function(err){
		if(err){
								////console.log('error');
								models='Fail';
							  mongoose.connection.close();
				    		callback(models);

		}else{
								mongoose.connection.close();
								callback('testdata created');
		}
		});
});
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

module.exports.searchtestdata=function(channel,environment,callback){
	var quryfind={'channel':channel,'environment':environment};
	////console.log('Both NULL');
	////console.log(quryfind);
	mongoose.connect("mongodb://userHKT:lrADL3lNvj2ug0gT@172.31.55.187:27017/transaction", function(err) {
	if(err){
		////console.log('DB error occured');
		models="DB Fail";
		db.close();
		mongoose.connection.close();
		callback(models);
	}
	usermgtObj.find(quryfind,function(err,docs){
		////console.log("retrieved records:");
			////console.log(docs);
			db.close();
			mongoose.connection.close();
			callback(docs);
	});
});
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
